<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Document</title>
</head>

<body>
  <video controls autoplay></video>

  <!-- <button id="start">Start</button>
  <button id="stop">Stop</button>
  <button id="capture">Capture</button> -->


  <button id="record">Start</button>
  <button id="capture">Capture</button>

  
  <script>
    let video = document.querySelector("video");
    // let startBtn = document.querySelector("#start");
    // let stopBtn = document.querySelector("#stop");
    let recordBtn = document.querySelector("#record");
    let capBtn = document.querySelector("#capture");
    let mediaRecorder;
    let isRecording = false;
    let chunks = [];

    // startBtn.addEventListener("click", function () {
    //   //recording start
    //   mediaRecorder.start();
    // });

 recordBtn.addEventListener("click", function (e) {
      if(isRecording){
        mediaRecorder.stop()
        isRecording = false
        e.currentTarget.innerText = "start"
      }
      else{
        
        mediaRecorder.start();
        isRecording = true;
        e.currentTarget.innerText =-
      }
    });


    stopBtn.addEventListener("click", function () {
      //recording stop
      mediaRecorder.stop();
    });

    capBtn.addEventListener("click", function () {
      //Screen  Display Image Saved
      let canvas = document.createElement("canvas");
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      let tool = canvas.getContext("2d");
      tool.drawImage(video, 0, 0);

      let link = canvas.toDataURL();
      let a = document.createElement("a");
      a.href = link;
      a.download = "img.jpg";
      a.click();
      a.remove();
      canvas.remove();

    });


    navigator.mediaDevices
      .getUserMedia({ video: true, audio: true })
      .then(function (mediaStream) {
        let options = { mimeType: "video/mp4" };

        mediaRecorder = new MediaRecorder(mediaStream, options);

        mediaRecorder.addEventListener("dataavailable", function (e) {
          chunks.push(e.data);
        });

        mediaRecorder.addEventListener("stop", function (e) {
          let blob = new Blob(chunks, { type: "video/mp4" });
          chunks = [];
          let a = document.createElement("a");
          let url = window.URL.createObjectURL(blob);
          a.href = url;
          a.download = "video.mp4";
          a.click();
          a.remove();
        });

        video.srcObject = mediaStream;
      })
      .catch(function (err) {
        console.log(err);
      });
  </script>
</body>

</html>